# Infra 面经集合

TCP 四次握手

TIME_WAIT 2MSL

拥塞控制

TCP 有哪几种关闭的情况。分两种：1）普通的正常关闭 2）收到 RST 后非正常关闭，因为 TCP 本身作为可靠协议理应把数据都发完再关闭，非正常关闭的话则会把发送缓冲区的数据都给扬了直接强退。

TCP 里的 RTT 和 RTO 怎么测量的？

有看过 Linux 内核怎么实现 TCP 的吗？啊这，无。

有看过 TCP 的 RFC 文档吗？啊这，无。

socket 编程： create, bind, listen, connect, accept, write, recv, close

Envoy socket: dispatcher OnAccept, 分配listener, 为listener注册file event onReadReady

那你讲讲 Linux 里 page fault 是怎么实现的？（恰好我也实现过这方面的功能，所以基本接住了接下来的几个问题）
(cr2得到fault触发地址)

子问题 1：Linux 下中断的触发流程 (保存现场, 陷入内核, 查询函数表, 跳转)

子问题 2：Linux 怎么确定是谁出发的 page fault (task struct)

子问题 3：page fault 判断线程没有访问内存的权限会发生啥 （查线程的 vmspace 发现这段内存没有被分配的话会触发 segment fault: 如果是地址非法或没有权限，则会向当前进程发送一个SIGSEGV signal，该signal默认会kill掉当前进程，并提示我们segmentation fault异常。）

子问题 4：page fault 分配物理内存失败时会触发啥错误？（犹犹豫豫的说应该是内存不足之类的错误码吧）

海量数据，如何判断某一个数在不在里面？ 布隆过滤器 or 位图，详细过程

布隆过滤器的结构：

布隆过滤器通常由一个位数组（Bit Array）和多个哈希函数组成。
初始时，位数组的所有位都被初始化为0。
添加元素：

要向布隆过滤器中添加一个元素，首先将该元素经过多个哈希函数得到多个哈希值。
然后将位数组中对应这些哈希值的位置设置为1。
查询元素：

要查询某个元素是否存在于布隆过滤器中，同样需要将该元素经过相同的哈希函数得到多个哈希值。
然后检查位数组中对应这些哈希值的位置是否都为1，如果都为1，则认为元素可能存在；如果有任何一个位置为0，则元素肯定不存在。
误判率：

布隆过滤器的主要特点是它可以快速告诉你某个元素可能存在，但存在一定的误判率。
当一个元素查询结果为存在时，实际上它可能不存在（因为其他元素的哈希值可能也会对应相同的位置）；但当一个元素查询结果为不存在时，它一定不存在。

哈希表的实现？ 哈希函数，开链法，扩容机制

线性探测（Linear Probing）：

在开放地址法中的一种常见方法，当发生哈希冲突时，线性探测会逐个检查下一个哈希桶，直到找到一个空桶或者找遍整个哈希表。
缺点是容易引发聚集，即连续的哈希冲突，导致性能下降。
二次探测（Quadratic Probing）：

与线性探测类似，但不是逐个检查下一个哈希桶，而是以二次方递增来查找下一个哈希桶。
有助于减少聚集，但仍可能出现问题。
双重散列（Double Hashing）：

双重散列是一种开放地址法，它使用多个哈希函数，而不仅仅是一个。
当发生哈希冲突时，它会应用第二个哈希函数来计算下一个哈希桶的位置。
这可以减少聚集，但需要合适的哈希函数选择。
再哈希（Rehashing）：

当哈希表的负载因子超过某个阈值时，可以选择重新创建一个更大的哈希表，并将所有元素重新哈希到新表中。
这可以有效地解决哈希冲突，但需要更多的内存和时间。

介绍一下平衡树和红黑树，说说区别？
介绍一下B树和B+树，说说区别？为什么数据库多使用B+树，而不是其他的数据结构？
跳表的原理和实现？
数据库事务ACID介绍一下，MySQL如何实现ACID？ 数据库我不太熟，就没多问

代码的编译和执行过程？预处理、汇编器、编译器、静态链接器、可执行文件
动态链接什么过程？
Linux下查看符号表命令、查看端口占用命令、查看进程打开的文件命令：nm， netstat，lsof
找出占用80端口的进程？ netstat -nlp | grep 80
进程的通信方法？ FIFO、共享内存、socket。底层怎么实现的？

pipe() 系统调用：

pipe() 是用于创建管道的系统调用。它创建一个管道，返回两个文件描述符，一个用于读取数据，另一个用于写入数据。
在底层，pipe() 系统调用会创建一个管道数据结构，该数据结构包含了两个文件描述符和一个缓冲区，用于在读取和写入之间传递数据。
文件描述符和文件表：

在Linux中，文件描述符是用于标识打开文件或其他I/O资源的整数。文件描述符由操作系统分配和管理。
当一个进程创建管道或打开文件时，操作系统会为其分配一个文件描述符，并将这些文件描述符存储在进程的文件表中。
管道的文件描述符可以通过读取和写入操作进行访问。进程可以通过文件描述符来读取从另一个进程写入管道的数据，或者将数据写入管道以供另一个进程读取。
内核缓冲区：

管道内核缓冲区是用于在两个管道文件描述符之间传递数据的内存区域。它是操作系统内核中的一部分。
当一个进程写入管道时，数据首先被写入内核缓冲区。如果另一个进程正在等待读取数据，数据将从内核缓冲区传递给读取进程。
进程调度：

在底层，操作系统内核使用进程调度机制来决定哪个进程在何时执行。
当一个进程写入管道时，操作系统可能将写入操作挂起，直到另一个进程准备好读取数据。这确保了数据的有序传递。
进程间同步：

管道的底层实现依赖于进程间同步机制，以确保数据在读取和写入之间正确地传递。
通常，这涉及到操作系统的信号量、互斥锁或其他同步原语的使用。


线程同步方法？ 信号量、锁
锁怎么实现？ 硬件锁机制，自旋锁CAS，mutex睡眠等待唤醒，rcu锁机制
容器有了解吗？CGroup是怎么实现的？
虚拟化和容器在资源隔离角度的理解？虚拟化有guest，要trap指令，页表隔离。容器只是限制资源使用，更加轻量。
LRU算法如何实现？双向链表保证有序，哈希表加快查找
使用双向链表：

LRU算法通常使用双向链表来实现。每个节点包含一个页面或数据块，并维护两个指针，一个指向前一个节点，一个指向后一个节点。最近访问的页面在链表头部，最久未使用的页面在链表尾部。

使用哈希表：

为了快速查找某个页面是否在链表中，通常使用哈希表来存储页面的地址和对应的链表节点。这样可以在O(1)时间内查找页面是否存在，并在链表中移动页面。

页面访问时的操作：

当某个页面被访问时，可以执行以下操作：
如果页面已经在链表中，将它移到链表头部，表示最近访问。
如果页面不在链表中，需要执行以下步骤：
如果链表未满，直接将新页面插入到链表头部。
如果链表已满，删除链表尾部的页面（表示最久未使用），然后将新页面插入链表头部。
淘汰页面时的操作：

当需要淘汰页面以腾出空间时，可以直接删除链表尾部的页面，因为它表示最久未使用的页面。

TCP三次握手、四次挥手? 为什么不是三次而是四次？
数据库事务一致性了解吗？Raft协议了解过吗？ 数据库不熟。。

mmap了解吗? COW了解吗?

TCP可靠性怎么保证？ 超时重传、序列号、checksum
超时重传的timeout多大？你来设计会怎么实现？定时器如何设计？了解Linux内核中定时器的实现吗？
接收端发现序列号不对会有什么操作？如何保证数据有序？
Linux内存管理? 伙伴系统？为什么需要Slab？内存回收是什么过程？
访问一个虚拟内存地址可能会有多少次内存访问？Linux几级页表？ 3 TLB？
mmap机制了解吗？为什么mmap文件读写比read/write快？mmap的文件，写入中途断电会怎么样？

可能因为自己写过一个小的操作系统，所以对于线程切换、同步等细节考察了一下
之后开始考察基础知识：
linux命令的使用，如何查看系统内存占用、处理器配置、root下的几个文件夹作用等
操作系统的基础概念，进程和线程、线程进程同步、虚拟内存机制等
其实我也很坦诚，不会就说不会，像问我数据库之类的...我真不会....

信号和信号量的区别？
内存栅栏是什么？ 多发射乱序执行
自旋锁、乐观锁、悲观锁区别？
kill -2和kill -9的区别？
对https的理解？

感觉是个巨佬，这次自我介绍都省了，上来直接就说我们聊聊linux内核
先是linux进程调度的调度算法，然后里面用到的数据结构（关于到底是红黑树还是堆，跟他略微讨论了一下）CFS中的进程的优先级和权重可以动态调整，因此需要一个支持高效插入和删除节点的数据结构。红黑树在这方面非常适合，因为它可以快速调整树的结构。堆通常不支持高效的动态调整，特别是在删除非根节点时需要重新堆化。

调度策略和算法数据结构：

Linux支持多种调度策略，如 Completely Fair Scheduler (CFS)、Round Robin 策略等。这些策略在内核中使用不同的数据结构来实现，如红黑树（用于CFS）和双向循环链表（用于Round Robin）等。

添加定时器：

一旦定时器被初始化，可以使用函数如add_timer()或hrtimer_start()将定时器添加到内核的定时器列表中。内核会根据定时器的超时时间将它插入到适当的位置。
硬件时钟中断：

定时器的超时时间通常是相对于硬件时钟中断的。Linux内核使用硬件时钟中断来跟踪时间的流逝，并在每次时钟中断时检查是否有定时器已经超时。
超时处理：

当定时器超时时，内核会执行指定的回调函数。这个回调函数可以是内核中的函数，也可以是用户态的回调函数。

linux分配堆内存的算法？
linux物理内存换页的算法？
用户空间申请信号量的时候，是如何陷入到内核空间的？
讲一下你知道的文件系统，Linux文件系统的数据结构是如何组织的？
一个小插曲...“你知道拜占庭将军吗？”
然后TCP方面的东西问了一下：
两个节点已经建立连接，但保持静默不发消息，如果一方重启，另一方会感知到吗？
